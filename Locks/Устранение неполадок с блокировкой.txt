Одним из самых простых способов узнать, страдает ли система от блокировки, 
является просмотр блокировки в статистике ожидания.

Чтобы устранить проблемы с блокировкой, необходимо выполнить следующие действия:
    1. Обнаружение запросов, связанных с блокировкой.
    2. Узнайть, почему происходит блокирование.
    3. Исправить основную причину проблемы.
    
Обнаружение запросов, связанных с блокировкой.
    Ключевым инструментом для устранения неполадок в режиме реального времени является динамическое представление sys.dm_tran_locks, 
    который предоставляет информацию о текущих активных запросах в Lock Manager (см. Получение информации о сеансах.sql).

    SQL Server помогает автоматически фиксировать информацию блокировки через blocked process report.
    В этом отчете содержится информация о состоянии блокировки, которую можно сохранить для дальнейшего анализа.
    
    Параметр конфигурации blocked process threshold, 
    определяет пороговое значение (в секундах), в течение которого блокированный процесс порождает сообщения (см. Blocked process threshold\Blocked process threshold.sql).
    
    Наиболее важной информацией с точки зрения заблокированного процесса является:
        waittime
            Продолжительность ожидания запроса в миллисекундах.
        lockMode
            Тип блокировки.           
        isolationLevel
            Уровень изоляции транзакций.
        executionStack и inputBuf
            Запрос и/или стек выполнения.
    
    Наиболее важной информацией с точки зрения блокируещего процесса является:
        status
            Это процесс, выполняемый, спящий или приостановленный. 
        trancount
            Значение trancount больше 1 указывает на вложенные транзакции. 
            Если статус процесса спящий и trancount больше 1, то есть вероятность того, что клиент не вложил вложенные транзакции правильно.
        executionStack и inputBuf
            Запрос и/или стек выполнения.
            
Почему происходит блокирование.
    Блокирование происходит, когда два или более сеансов конкурируют за один и тот же ресурс. 

    Во время устранения неполадок вам необходимо ответить на два вопроса: 
        1. Почему блокирующий сеанс удерживает блокировку ресурса?
        2. Почему заблокированный сеанс получает блокировку ресурса?

    Обычно проще начать поиск неисправностей, просмотрев заблокированный сеанс, 
    где у вас есть заблокированный оператор и его план выполнения (см. Плоучение информации о заблокированных и блокирующих сеансах.sql).
    
Устранение неполадок при эскалации блокировки.
    Extended Events
        lock_escalation
    
    SQL Server Profiler
        Lock:Escalation
          
    SQL Server:Access Methods
        Lock Escalations/sec
            Количество эскалаций происходит в секунду.

    В случае, если эскалация блокировки инициированной писателями, 
    вы можете уменьшить количество пакетов до той точки, 
    в которой они собирают менее 5000 блокировок на уровне строк и страниц на один объект.
    
    Что касается эскалации блокировки, инициированной читателями, 
    следует избегать ситуаций, в которых хранится много общих (S) блокировок.
    
    Одним из примеров является сканирование из-за неоптимизированных индексов или запросов с уровнем изоляции REPEATABLE READ или SERIALIZABLE, 
    когда запросы хранят блокировки общего доступа (S) до конца транзакции.
    
    В некоторых случаях вы можете рассмотреть разделение таблиц и установить опцию эскалации блокировки для использования эскалации уровня разделов, 
    а не уровня таблицы, используя инструкцию ALTER TABLE SET LOCK_ESCALATION = AUTO.
    Это может помочь в сценариях, в которых вы должны очистить старые данные с помощью оператора DELETE или запустить запросы по старым данным в уровнях изоляции REPEATABLE READ или SERIALIZABLE.
    В этих случаях утверждения активируют блокировки для разделов, а не таблиц, а запросы, которые не имеют доступа к этим разделам, не будут блокироваться.
    
Память затраченная на блокировки.
    SELECT SUM(pages_kb) AS memory_kb
    FROM   sys.dm_os_memory_clerks
    WHERE  type = 'OBJECTSTORE_LOCK_MANAGER';
    
    SQL Server:Memory Manager
        Lock Memory (KB)
            Показывает общий объем памяти, который сервер использует для блокировок.    