Пакетный режим (batch mode).
    Новый формат хранения данных индексов columnstore позволяет SQL Server реализовать новую модель исполнения пакетного режима (batch mode), 
    что значительно снижает нагрузку на процессор и время выполнения запросов хранилища данных. 
    
    В этом режиме SQL Server обрабатывает данные в группами строк или пакетами, 
    а не по одной строке за раз. 
    
    Размер пакетов варьируется, чтобы вписаться в кеш процессора, что сокращает количество запросов, 
    требуемых процессором для запроса внешних данных из памяти или других компонентов.
    
    Более того, пакетный подход улучшает производительность агрегатов, 
    что может быть рассчитано для каждого пакета, а не для каждой строки.
    
    В отличие от выполнения режима строки, где значения данных копируются между операторами, 
    обработка пакетного режима пытается минимизировать такие копии, 
    создавая и поддерживая специальную битовую карту (bitmap), которая указывает, сохраняется ли строка в пакете.

    В SQL Server 2012 и 2014 исполнение пакетного режима работает только в параллельных планах выполнения.
    
    SQL Server 2012 переключается в режим строки в случаях разливов tempdb.
    SQL Server 2014 и 2016 поддерживают пакетный режим даже в случаях разливов tempdb.
    
    SQL Server 2016 может использовать пакетный режим в последовательных планах, 
    когда уровень совместимости базы данных установлен в 130.
    
    Возможность использования пакетного режима в последовательных планах зависит от уровня совместимости базы данных, 
    а не от модели оценки мощности.
    
    SQL Server 2016 сможет использовать его даже в том случае, если устаревшая оценка мощности включена в конфигурации с областью видимости базы данных, 
    если для уровня совместимости базы данных установлено значение 130.
    
    Убедитесь, что запросы к таблицам с индексами столбцов могут использовать параллелизм в случае, 
    если вы переходите на SQL Server 2016 и решаете сохранить уровень совместимости базы данных менее 130.
    
Параллелизм.
    SQL Server обрабатывает параллелизм в режиме строки и исполнения в пакетном режиме по-разному.
    
    В режиме строки оператор обмена (Exchange (Distribute Streams)) распределяет строки между различными параллельными потоками, 
    используя один из доступных алгоритмов распределения.
    
    После распределения строка никогда не переносится из одного потока в другой, 
    пока другой оператор обмена (Exchange (Gather Streams)) не соберет или не перераспределит данные.

    SQL Server использует другой подход с выполнением пакетного режима (см. рис. Параллелизм в режиме пакетного режима). 
    В этом режиме каждый оператор имеет очередь рабочих элементов (пакетов) для обработки.
    Рабочие потоки из общего пула выбирают элементы из очередей и обрабатывают их при переходе от оператора к оператору.

    Одной из распространенных проблем, которые увеличивают время отклика параллельных запросов при выполнении режима строки, 
    является неравномерное распределение данных. 
    
    Операторы обмена ждут завершения всех параллельных потоков, таким образом, 
    время выполнения зависит от самого медленного потока. 
    
    Некоторые потоки выполняют больше работы, чем другие, когда данные распределяются неравномерно.
    
    Выполнение пакетного режима устраняет такие проблемы. 
    Каждый поток поднимает рабочие элементы из общей очереди до тех пор, пока очередь не будет пустой.
    